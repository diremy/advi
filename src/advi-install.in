#!/bin/bash

advi_texdir='@ADVI_TEXDIR@'
texdir='@TEXDIR@'
relpath=tex/latex

src=${advi_texdir}/${relpath}
parent=${texdir}/${relpath}
dest=${parent}/advi

install-message () {
    echo 'This is going to install latex files ecurrently in:'
    echo
    echo '    ' "${src}/"
    echo
    echo 'in the distribution repository'
    echo
    echo '    ' "${dest}/"
    echo
    echo 'You may also do this manually.'
    echo 'Alternatively, you may copy the files some other location'
    echo 'in you TEXINPUTS path.'
    echo
}

installed () {
    if test ! -r ${dest}
    then
        echo "No files installed in ${dest}"
        exit 1;
    fi
}

check () {
    if test ! -w ${parent}
    then
        echo 'The destination is not writable: echo you need to run this scrip as root.'
        exit 1;
    fi

    read -p 'Continue [y/n] ' answer

    case ${answer} in
        y) ;;
        *) echo 'Aborted'; exit 1 ;;
    esac    
}

doinstall () {    
    echo "install ${src}/* ${dest}" && \
        install ${src}/* ${dest}/ && \
        echo mktexlsr && \
        mktexlsr && \
        echo Done || (echo 'An error occured'; exit 1)
}

uninstall-message () {
    echo 'This is going to uninstall latex files ecurrently in the distribution repository'
    echo
    echo '    ' "${dest}/"
    echo
    echo 'You may also do this manually.'
    echo
}

douninstall () {
    for i in $(cd ${dest} && ls)
    do
        rm -v ${dest}/$i
    done && 
    rmdir ${dest} &&
    mktexlsr
}

usage () {
    echo Usaage:
    echo '    advi-install'
    echo '    advi-install --uninstall'
    exit 2
}

case $# in
    0) install-message && check && doinstall ;;
    1) case $1 in
           --uninstall) installed && uninstall-message && check && douninstall ;;
           *) usage ;;
       esac ;;
    *) usage
esac
