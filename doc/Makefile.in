#*********************************************************************#
#                                                                     #
#                             Active-DVI                              #
#                                                                     #
#                   Projet Cristal, INRIA Rocquencourt                #
#                                                                     #
#  Copyright 2002 Institut National de Recherche en Informatique et   #
#  en Automatique.  All rights reserved.  This file is distributed    #
#  under the terms of the GNU Lesser General Public License.          #
#                                                                     #
#  Jun Furuse, Didier Rémy and Pierre Weis.                           #
#  Contributions by Roberto Di Cosmo, Didier Le Botlan,               #
#  Xavier Leroy, and Alan Schmitt.                                    #
#                                                                     #
#  Based on Mldvi by Alexandre Miquel.                                #
#*********************************************************************#

# $Id$

include ../Makefile.config

TEX_ENV		= TEXINPUTS=.:../tex:$$TEXINPUTS
DVIPS_ENV	= TEXPSHEADERS=.:../tex:

# The list of HTMLC dependant files
HTML_SRC_FILES	= index.htm fra.htm eng.htm \
		  faq-eng.htm faq-fra.htm \
		  screen-shots-fra.htm screen-shots-eng.htm
MAN_SRC_FILES	= advi.man
HTML_FILES	= $(HTML_SRC_FILES:.htm=.html)
MAN_FILES	= $(MAN_SRC_FILES:.man=.1)
HTMLC_FILES	= $(HTML_FILES) $(MAN_FILES)

# The list of HEVEA dependant files
HEVEA_FILES	= manual.dvi manual.ps manual.pdf manual.html advi_remote.html

# the list of LaTeX dependant files
LATEX_FILES	= splash.dvi splash.ps \
		  scratch_write_splash.dvi scratch_write_splash.ps \
		  scratch_draw_splash.dvi scratch_draw_splash.ps \
		  mathmode.dvi \
		  advi_remote.dvi

ALL_DOC_FILES	= @ALL_DOC_FILES@

all: $(ALL_DOC_FILES) ../Makefile.config

install: $(ALL_DOC_FILES)
	$(INSTALL) -m 644 $(HELP_FILES) $(DESTDIR)$(ADVI_LOC)
	- $(INSTALL) -d $(DESTDIR)$(mandir)/man$(MANEXT)
	$(INSTALL) -m 644 $(MAN_FILES) $(DESTDIR)$(mandir)/man$(MANEXT)

clean:
	$(RM) $(ALL_DOC_FILES)
	$(RM) *~ *.out
	$(RM) *.aux *.log *.dvi *.toc *.ps
	$(RM) *.pdf *.pdfm
	$(RM) *.haux *.htoc *.ima

manual.dvi: ../tex/advi.sty manual.sty splash_contents.tex \
       scratch_write_splash_contents.tex scratch_draw_splash_contents.tex
splash.dvi: splash_contents.tex
scratch_write_splash.dvi: scratch_write_splash_contents.tex
scratch_draw_splash.dvi: scratch_draw_splash_contents.tex

manual.html: manual.tex manual.sty macros.hva 
advi_remote.html: advi_remote.tex manual.sty macros.hva 

.SUFFIXES:
.SUFFIXES: .tex .dvi .advi .ps .pdf .pdfm .html .htm .ima .man .1

.tex.dvi:
	# To avoid default hypertex.cfg if it exists.
	# Active-DVI really needs the hypertex driver...
	$(TEX_ENV) $(LATEX) '\def\driver{hypertex}\input' $<
	$(TEX_ENV) $(LATEX) '\def\driver{hypertex}\input' $<
	$(TEX_ENV) $(LATEX) '\def\driver{hypertex}\input' $<

.tex.ps:
	if [ -e $*.dvi ]; then \
	  $(MV) $*.dvi $*.advi; \
	fi
	$(TEX_ENV) $(LATEX) '\def\driver{dvips}\input' $<
	$(DVIPS_ENV) $(DVIPS) -o $@ $*.dvi
	  $(MV) $*.dvi $*.bdvi
	if [ -e $*.advi ]; then \
	  $(MV) $*.advi $*.dvi; \
	fi

.tex.pdf:
	if [ -e $*.dvi ]; then \
	  $(MV) $*.dvi $*.advi; \
	fi
	$(TEX_ENV) $(LATEX) '\def\driver{dvipdfm}\input' $<
	- $(DVIPDFM) -o $@ $*.dvi
	if [ -e $*.advi ]; then \
	  $(MV) $*.advi $*.dvi; \
	fi

.advi.dvi:
	cp -p $< $*.dvi

.html.ima:
	if [ -f $*.image.tex ]; then $(PDFIMAGEN) $*; fi
	touch $*.ima

.tex.html:
	$(HEVEA) $(HEVEA_FLAGS) -fix macros.hva -o $*.html $*.tex

.htm.html:
	$(HTMLC) $(HTMLC_FLAGS) -f $< -t $@

.man.1:
	$(HTMLC) $(HTMLC_FLAGS) -f $< -t $@
