\documentclass[12pt]{article}

\usepackage {manual}
\usepackage {fullpage}
\usepackage {makeidx}

\expandafter \ifx \csname driver\endcsname\relax \def \driver{}\fi 
\usepackage [\driver]{hyperref}

\usepackage {advi}
\usepackage {advi-annot}
\usepackage {bubble}

\title {{\ActiveDVI} manual}
\author {Didier R{\'{e}}my and ???}
\def \ActiveDVI {\textbf {Active-DVI}}


\begin{document}

\maketitle

\begin{abstract}
Put a Summary of Active DVI. 
\end{abstract}

\tableofcontents

\section {Installation}

\section {Using the {\ActiveDVI} previewer}

\subsection {Command line options}

See the command help
\begin{verbatim}
advi -help
\end{verbatim}

\subsection {Cut and paste}

\subsection {Hyperrefs}

\subsection {Moving around}

See the key bindings in the appendix.

\section {The {\tt advi} package}

This package provides commands interactive with {\ActiveDVI}. 
This package does not have to be loaded if one does not need special
effects. The package recognizes the option \verb"ignore", which 
makes all not produce any {\tt advi} specials, 
so that it can be previewed by other previewers or turned into Postscript 
with {\tt dvips}. Of course, this will disable most effects, although some
of them will be approximated.

If the global option is not {\tt ignore} is not set, it is possible to set
it locally with the commands {\docdef \adviignore}. However, this will not
ignore all actions, since some decisions are taken when the package is
loaded.

The package also defines the conditional {\docdef \ifadvi} which evaluate
its first argument if advi is not ignore and its second argument otherwise.

\subsection {Pause, Record and Play}

\medskip\noindent
\docdef \adviwait\docopt{seconds}
\begin{quote}
Wait for \docid{seconds} or without argument forever, that is, until the
user requests to continue (or to change page).
\end{quote}

\medskip\noindent
\docdef \advirecord \doctt{[play]}\docarg{tag}\docarg{latex code}
\\
\docdef \begin\doctt{\{advirecording\}}%
\doctt{[play]}\docarg{tag}\docarg{latex code}%
\docid {text}\docdef \end\doctt{\{advirecording\}}
\begin{quote}
The computes \docid{latex code} and record its DVI ouput under tag
\docid{tag}. The DVI output is not displayed during recording, unless the
option \doctt{play} is set.

Records can be embedded. The inner record is always recorded
its own  tag. It is also recorded under the outer tag if the inner record is
played when recording.

In the environment form, \docid{latex code} may contain fragile commands. 
\end{quote}

\medskip\noindent
\docdef \adviplay\docopt{color}\docarg{tag}
\begin{quote}
Replay the DVI previously recorded as \docid{tag}.
The optional argument changes the color to \docid{color} during replay. 
\end{quote}

\medskip\noindent
\docdef \advianchor\docopt{activation}\docarg{tag}\docarg{text}
\\
\docdef \begin\doctt{\{advianchoring\}}\docopt{activation}\docarg{tag}%
\docid {text}\docdef \end\doctt{\{advianchoring\}}
\begin{quote}
Play record when anchor is activated. The argument \docid{activation} may
either be \doctt{over} or \doctt{click}. The page is reset to its original
appearance when the anchor is no more activated (the mouse leaves the anchor
area or the button is released). 

In the environment form, \docid{text} may contain fragile commands. 
\end{quote}


\subsection {Images}

\subsection {Backgrounds}

\medskip\noindent
\docdef \advibg \doctt {[global]}\docarg{key=value list}
\begin{quote}
where \docid{key=value list} is a list of bindings of the followning kind:

\dockey[none]{color}{color}
\begin{quote}
Set the background color to \docid{color}
(\doctt{none} means unset).
\end{quote}

\dockey[none]{image}{file}
\begin{quote}
Use the file from \docid{file} as background
(\doctt{none} means unset).
\end{quote}

\dockey[auto]{fit}{fit style}
\begin{quote}
Fit the background image according to \docid{style}, which may only be 
{\tt auto} or one of the following keywords:
\begin{center}
\tt
auto \hfill {\rm or} \hfill
\begin{tabular}{l@{\qquad}c@{\qquad}r}
topleft&   top& topright\\
left&  center&  right \\
bottomleft& bottom & bottomright\\
\end{tabular}
\end{center}
The {\tt auto} fit mode means scale the image as desired in both directions
so that it fits the page. The other styles only allows the same scaling
factor in both directions:
\begin {itemize}

\item
Corner-styles mean adjust the image in the corner
and scale so that all the page is covered. 

\item
{\tt center} means scale the
image so that all the page is covered and center it on the page. 

\item
Segment-styles mean adjust the image and the page on the segment (in which
case, the image may not totally cover the page on the opposite side). 

\end {itemize}
\end{quote}

\dockey[none]{alpha}{float}
\begin{quote}
Set the alpha factor for the background image to \docid{float}
(\doctt{none} means unset).
\end{quote}

\dockey[none]{blend}{blend mode}
\begin{quote}
Set the blend mode to \docid{blend mode}, which should be one of the
following (unchecked): {\tt difference}, XXX?
(\doctt{none} means unset).
\end{quote}

\goodbreak
\dockey{none}{}
\begin{quote}
Unset all background paremeters.
This key can only appear alone, without argument and without any other key. 
\end{quote}
The optional parameter \doctt{global} indicates that
the definition is global and will affect the following pages, 
as well as the current page. 

By default, the transition affects only the current page. 
\end{quote}

\subsection {Transitions}

\docdef \advitransition \doctt {[global]}\docarg {key=val list}
\begin{quote}
where \docid{key=value list} is a list of bindings of the following kind:

\dockey{none}{} or \dockey{slide}{} or \dockey{block}{} or \dockey{wipe}{}
\begin{quote}
Set the transition mode to the corresponding key.
One of this key is mandatory (several is should be illegal, but in fact
overides the previous one). 
\end{quote}

\dockey{from}{direction}
\begin{quote}
Make the transition come from \docid{direction}.  Directions are not checked
but should be one of the following: 
\begin{center}
\tt
\begin{tabular}{l@{\qquad}c@{\qquad}r}
topleft&   top& topright\\
left&  center&  right \\
bottomleft& bottom & bottomright\\
\end{tabular}
\end{center}
\end{quote}

\dockey{steps}{n}
\begin{quote}
Make the transition in \docid{n} steps. 
\end{quote}
As for \docdef \advibg, the optional parameter \doctt{global} indicates that
the definition is global and will affect the following pages, 
as well as the current page. 

By default, the transition affects only the current page. 
\end{quote}

\medskip\noindent
\docdef \advitransbox \docarg {key=val list}\docarg{hbox material}
\begin{quote}
where \docid {key=val list} is as above and \docarg{hbox material} is
whatever can follow an \docdef \hbox{} command. In particular, the material
may contain verbatim commands, since as for the \docdef\hbox{} it is 
parsed incrementally.
\end{quote}

\subsection {Hyperrefs}

{\ActiveDVI} supports hyperrefs. 

Explain \verb"<a name>aaa</a>"

\subsection {Embed applications anchors}

The commands are 

\medskip\noindent
\docdef \adviembed\docopt{key=value list}\docarg{command} 

\begin{quote}
where \docid{key=value list} is a list of bindings of the following kind:

\dockey{name}{name}
\begin{quote}
Allows to refer to the embedded application as \docid{name}. 
Annonymous applications have actually the default name \doctt{anonymous}.
\end{quote}

\dockey{ephemeral}{name}

\begin{quote}
This is the default case: the embedded application is killed when the page
is turned.
\end{quote}

\dockey{persistent}{name}

\begin{quote}
The application keeps running in the background, but will only be visible in
the current page.
\end{quote}

\dockey{width}{dim}\\
\dockey{height}{dim}
\begin{quote}
The application takes \docid{dim} width (respectively height) space in 
latex. Both values default to 0pt.

These dimentions are also substituted for all occurrences of \verb"!g" in
the command string.
\end{quote}

\dockey{sticky}{name}
\begin{quote}
The application keep running and remains visible when turning pages.
\end{quote}

\end{quote}

\medskip\noindent
\docdef \advikillembed \docarg{name}
\begin{quote}
Kill all embedded applications named \docid{name}
\end{quote}


\subsection {Active anchors}

The command is 

\medskip\noindent
\docdef \advianchor \docarg{tag}\docarg {text}
\\
\docdef \begin\doctt{\{advianchor\}}\docarg{tag}%
\docid {text}\docdef \end\doctt{\{advianchor\}}
\begin{quote}
The text is first display as usual and mark as active. 
Mouving the mouse above the text will display the record \docid{tag}.

In the environment form, \docid{text} may contain fragile commands. 
\end{quote}

\subsection {Postscript specials}

{\ActiveDVI} can deal with most of PStricks calling {\tt ghostscript} on
included Postscripts. However, the interactive between {\ActiveDVI} and
Postscripts is not always working.
\begin {itemize}

\item
Since characters are rendered by{\ActiveDVI}, some PStricks are not allowed.
\item
Some change of repairs are also not yet correctly perfomed.  
\end {itemize}

\subsubsection {Overlays}

\index{overlays}

The {\tt overlay} class implements overlays with PStricks.  Instead,
{\ActiveDVI} implements overlays directly, using records and plays.
This is more efficient, and of course more natural.
(In fact, {\ActiveDVI} chooses the cumulative semantics of overlays
display if all layers below the current overlay.)

The {\tt xprosper} style derived from the {\tt prosper} class uses 
the {\tt overlay} class and also work with {\ActiveDVI} in exactly the same
way (relaxing the \overlay@loop macro inhibits all layers, but the first
page). 

\subsubsection {PStricks}

{\ActiveDVI} can deal with most of PStricks. 
\begin {itemize}

\item[+]
Simple drawings work

\item[+] 
{\tt\string\SpecialCoor} works, {\em i.e.} commands of the form
{\tt \string \rput \{A\}\{bla bla\}} works where {\tt A} is a node

\item[+]
Connections between nodes {\tt \string \ncarc}, {\tt \string \ncarc},
also works.
\end {itemize}
However, some PStricks are known not to work.
\begin{itemize}
\item[--]
Labels over arrows \verb"\Aput", \verb"Bput", etc.
(they change the Postscript coordinates...)

\item[--]
{\tt pspicture}
(idem, but drawings that are not embedded in pspictures works)

\end {itemize}


\section {Auxiliary packages}

\subsection*{The superpose package}

This package allows to easily supperpose horizontal material, creating 
the smallest horizontal box to fix all of supperpositions.
\begin{verbatim}
\usepackage{superpose}
\end{verbatim}
The package  defines a single environment:

\medskip\noindent
\docdef\begin\doctt{\{superpose\}}\docopt{alignment}\docid {list}%
\docdef\end\doctt{\{superpose\}}
\begin{quote}
The \docid{alignment} can one the letters \doctt c (default value), \doctt
l, or \doctt r.

Items of the list must are sepated by \verb"\\" as in tabular environments.
Each item should be horizontal material.
\end{quote}

\subsection*{The bubble package}

This package allows to easily draw bubbles over some text. 
\begin{verbatim}
\usepackage{bubble}
\usepackage[ps]{bubble}
\end{verbatim}
By default bubbles are produced using the \doctt{epic} and \doctt{eepic}
packages, for portability. However, for better rendering and easier 
parameterization, bubble can also be drawn using the \doctt{ pst-node}
package of the pstricks collection.  This is was the \doctt{ps} option
does. 

The package  defines a single command:

\medskip\noindent
\docdef \bubble \docopt{key=value list}\docarg{anchor}%
    \docopt{ps options}\docpar {pos}\docarg{text}
\begin{quote}
The \docid{key=value list} is a list of bindings of the following kind:

\dockey[yellow]{bg}{color}
\begin{quote}
The background color for annotations. 
\end{quote}

\dockey[yellow]{unit}{dim}
\begin{quote}
Set the package unit to \docid{dim}.
\end{quote}

\dockey[c]{col}{colspec}
\begin{quote}
Where \docid{colspec} is a column specification for the tabular
environment. Moreover, the following abbreviations are recognized:

\smallskip
\tt
\begin{tabular}{|l|l|}
\hline
\rm\em key & \rm expands to \\
\hline
c &  col=c\\
l &  col=l\\
r &  col=r\\
p=\docid{w} & col=p\docarg{w}\\
\cline{1-2}
\end{tabular}
\begin{tabular}{|l|l|}
\hline
\rm\em key & \rm expands to \\
\hline
C &  col=\{>\{\$\}c<\{\$\}\}\\
L &  col=\{>\{\$\}l<\{\$\}\}\\
R &  col=\{>\{\$\}r<\{\$\}\}\\
P\docid{w} &  \doctt{col=\{>\{\$\}p\docarg{w}<\{\$\}\}}\\
\cline{1-2}
\end{tabular}
\end{quote}

\docid{pos} is the optional relative position of the annotation 
defaults to $1,1$ and is counted in the package unit. 

\docid{ps options} are passed to  the command \docdef\psset) 
in \doctt{ps} mode and ignored otherwise. 
\end{quote}
Parameters (color and tabular column specification) can also 
be set globally using the command:

\medskip \noindent
\docdef \setkeys\doctt{\{bubbleset\}}\docarg{key=value list}

\subsection*{Annotations package}

This package uses active anchors and the package bubbles to 
allow annotations by raising a bulle when the cursor is over the anchor.

The package provides a single command

\medskip\noindent
\docdef \adviannot \docopt{key=value list}\docarg{anchor}%
    \docopt{ps options}\docpar {pos}\docarg{text}
\begin{quote}
whose options are identical to those of \docdef \bubble, but the bubble
appear withing an active anchor. 
\end{quote}

%Annotation location can also be invisible \advi{C}{\tt{ }}instead of visible.


\appendix


\section {Known bugs}

\subsection*{Inlined postscript}

PS relies on {\tt ghoscript} to display Postscript inlined specials.
However, some earlier releases of {\tt ghostscript} 
implements Postscript {\tt flushpage} command as a {\tt XFlush} 
which does not force evaluations of commands, and make the 
synchronization between {\tt ghostscrip} and {\tt advi} drawings 
uncontrolable. In this case, the inerleaving of inlined postscript 
and other material may be inconsistent. 

Fortunately, it seems that recent version of ghostscript $(> 6.5)$ have
fixed this problem by using {\tt XSync(false)} instead.
There, inline specials should be correctly rendered. 

However, version some releases of 6.5x also carry a small but fatal bug for
advi, that will be hopefully be fixed in future releases. This can easily be
fixed, thoug (see \url{http://cristal.pauillac.inria.fr/~remy/ghostscript/}).

\subsection*{Inlined postscript}

So far, the implementation of inline Postscript does not correctly handle
complex change of coordinates.  (See PStricks section). 


\section {Future}

\section {Key bindings}

\section {Index}

\printindex

\end{document}
